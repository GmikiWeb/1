<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GmikiRed System</title>
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º –º—è–≥–∫–∏–π –∏ —Å–∫—Ä—É–≥–ª–µ–Ω–Ω—ã–π —à—Ä–∏—Ñ—Ç Ubuntu -->
    <link href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@300;400;500;700&display=swap" rel="stylesheet">
    <!-- Chart.js –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–æ–≤ -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- html2canvas –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è PNG -->
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <!-- jsPDF –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <!-- Favicon –∏–∫–æ–Ω–∫–∞ -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üî¥</text></svg>">
    <style>
        :root {
            --bg: #1a1c1e;
            --surface: #24272b;
            --panel: #1e2124;
            --accent: #e57373; /* –ö—Ä–∞—Å–Ω—ã–π –∞–∫—Ü–µ–Ω—Ç –≤–º–µ—Å—Ç–æ —Å–µ—Ä–æ–≥–æ */
            --text: #e1e1e1;
            --text-dim: #9ba1a6;
            --red: #e57373;
            --green: #81c784;
            --blue: #64b5f6;
            --purple: #ba68c8;
            --orange: #ffb74d;
            --radius: 14px;
            --transition: all 0.25s ease;
        }

        * { box-sizing: border-box; }
        
        body {
            font-family: 'Ubuntu', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* NAV */
        nav {
            height: 64px;
            background: var(--panel);
            display: flex;
            align-items: center;
            padding: 0 40px;
            gap: 40px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            z-index: 100;
            flex-shrink: 0;
        }

        .nav-logo {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-right: 40px;
        }

        .logo-icon {
            font-size: 1.5rem;
            color: var(--red);
            filter: drop-shadow(0 0 5px rgba(229, 115, 115, 0.3));
        }

        .logo-text {
            font-weight: 800;
            font-size: 1.2rem;
            background: linear-gradient(90deg, var(--red), #ff9a9a);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: 1px;
        }

        .nav-item {
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            color: var(--text-dim);
            font-size: 0.9rem;
            position: relative;
            transition: var(--transition);
            white-space: nowrap;
        }

        .nav-item.active { color: #fff; }
        .nav-item.active::after {
            content: '';
            position: absolute;
            bottom: -22px;
            left: 0;
            width: 100%;
            height: 3px;
            background: var(--accent);
            border-radius: 10px 10px 0 0;
        }

        /* WRAPPER */
        #main-wrapper { 
            display: flex; 
            flex-grow: 1; 
            overflow: hidden;
            min-height: 0;
        }

        /* SIDEBAR */
        #sidebar {
            width: 320px;
            background: rgba(30, 33, 36, 0.4);
            backdrop-filter: blur(10px);
            border-right: 1px solid rgba(255,255,255,0.05);
            padding: 30px;
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
        }

        .btn-action {
            background: var(--surface);
            color: var(--text);
            border: 1px solid rgba(255,255,255,0.1);
            padding: 14px 20px;
            border-radius: var(--radius);
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition);
            font-family: 'Ubuntu', sans-serif;
        }
        .btn-action:hover { background: #2f3338; border-color: var(--accent); transform: translateY(-2px); }

        .user-tab {
            padding: 16px;
            background: rgba(255,255,255,0.02);
            border: 1px solid rgba(255,255,255,0.05);
            border-radius: var(--radius);
            margin-top: 12px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: var(--transition);
            animation: fadeIn 0.3s ease;
        }
        .user-tab.active { border-color: var(--accent); background: rgba(255,255,255,0.08); box-shadow: 0 4px 15px rgba(0,0,0,0.2); }

        /* CONTENT */
        #protocol-content { 
            flex-grow: 1; 
            padding: 60px; 
            overflow-y: auto;
            min-height: 0;
        }
        .card { 
            background: var(--surface); 
            padding: 45px; 
            border-radius: 24px; 
            max-width: 800px; 
            margin: 0 auto; 
            box-shadow: 0 25px 50px rgba(0,0,0,0.3);
            animation: fadeIn 0.5s ease-out;
        }

        label { 
            color: var(--text-dim); 
            font-size: 0.75rem; 
            font-weight: 700; 
            text-transform: uppercase; 
            letter-spacing: 1.5px; 
            margin-bottom: 12px; 
            display: block; 
        }

        input[type="text"] {
            width: 100%;
            background: #1a1c1e;
            border: 2px solid rgba(255,255,255,0.05);
            color: #fff;
            padding: 16px;
            border-radius: 12px;
            margin-bottom: 15px;
            outline: none;
            transition: var(--transition);
            font-family: 'Ubuntu', sans-serif;
            font-size: 1rem;
        }
        input[type="text"]:focus { border-color: var(--accent); background: #141618; }

        /* EDITOR */
        #editor-view { 
            display: none; 
            width: 100%; 
            height: 100%; 
            padding: 30px; 
            gap: 30px; 
            animation: fadeIn 0.4s ease;
            flex-direction: column;
            overflow: hidden;
            min-height: 0;
        }
        .editor-container { 
            flex: 1; 
            display: flex; 
            flex-direction: column; 
            gap: 15px;
            min-height: 0;
        }
        textarea {
            flex-grow: 1;
            background: #141618;
            border: 2px solid rgba(255,255,255,0.05);
            border-radius: var(--radius);
            padding: 25px;
            color: #b5cea8;
            font-family: 'JetBrains Mono', monospace;
            resize: none; 
            outline: none; 
            font-size: 0.95rem;
            min-height: 200px;
        }
        iframe { 
            flex: 1; 
            border-radius: var(--radius); 
            border: none; 
            background: white;
            min-height: 200px;
        }

        /* FULLSCREEN MODE */
        #fullscreen-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: var(--bg);
            z-index: 9999;
            flex-direction: column;
            animation: fadeIn 0.3s ease;
        }

        .fullscreen-header {
            height: 64px;
            background: var(--panel);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 30px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            flex-shrink: 0;
        }

        .fullscreen-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 700;
            font-size: 1.2rem;
            color: var(--text);
        }

        .fullscreen-title .logo-icon {
            font-size: 1.2rem;
        }

        .fullscreen-controls {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .fullscreen-hint {
            color: var(--text-dim);
            font-size: 0.9rem;
            margin-right: 20px;
        }

        .fullscreen-content {
            flex: 1;
            display: flex;
            overflow: hidden;
            padding: 20px;
            gap: 20px;
        }

        .fullscreen-preview {
            flex: 1;
            border-radius: var(--radius);
            border: none;
            background: white;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .close-fullscreen-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            background: var(--red);
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 1.5rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            transition: var(--transition);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .close-fullscreen-btn:hover {
            transform: scale(1.1);
            background: #ff4444;
        }

        /* GRAPH VIEW */
        #graph-view {
            display: none;
            width: 100%;
            height: 100%;
            padding: 20px;
            gap: 20px;
            animation: fadeIn 0.4s ease;
            flex-direction: column;
            overflow: hidden;
            min-height: 0;
        }

        .graph-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--surface);
            padding: 20px;
            border-radius: var(--radius);
            margin-bottom: 10px;
            flex-shrink: 0;
        }

        .graph-type-selector {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .graph-type-btn {
            padding: 8px 16px;
            background: var(--bg);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 8px;
            color: var(--text-dim);
            cursor: pointer;
            font-size: 0.85rem;
            transition: var(--transition);
            white-space: nowrap;
        }

        .graph-type-btn.active {
            background: var(--accent);
            color: var(--bg);
            border-color: var(--accent);
        }

        .graph-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: var(--surface);
            border-radius: var(--radius);
            padding: 20px;
            gap: 20px;
            overflow: hidden;
            min-height: 0;
        }

        .chart-area-wrapper {
            flex: 1;
            position: relative;
            background: rgba(255,255,255,0.02);
            border-radius: var(--radius);
            padding: 20px;
            overflow: auto;
            min-height: 300px;
        }

        .chart-controls {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .dataset-selector {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            padding: 10px 0;
            flex: 1;
            min-width: 0;
        }

        .dataset-tab {
            padding: 8px 16px;
            background: var(--bg);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 8px;
            color: var(--text-dim);
            cursor: pointer;
            white-space: nowrap;
            transition: var(--transition);
            position: relative;
            flex-shrink: 0;
        }

        .dataset-tab.active {
            background: var(--accent);
            color: var(--bg);
            border-color: var(--accent);
        }

        .dataset-tab.active::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 50%;
            transform: translateX(-50%);
            width: 20px;
            height: 3px;
            background: var(--accent);
            border-radius: 2px;
        }

        .dataset-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            display: inline-block;
            margin-right: 8px;
            vertical-align: middle;
        }

        .dataset-editor {
            background: var(--bg);
            padding: 20px;
            border-radius: var(--radius);
            border: 1px solid rgba(255,255,255,0.05);
            margin-top: 10px;
            flex-shrink: 0;
        }

        .point-controls {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 10px;
            margin-top: 10px;
            overflow-y: auto;
            max-height: 200px;
            padding: 5px;
        }

        .point-item {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .point-value {
            background: var(--surface);
            border: 1px solid rgba(255,255,255,0.1);
            color: var(--text);
            padding: 8px;
            border-radius: 6px;
            text-align: center;
            outline: none;
        }

        .point-value:focus {
            border-color: var(--accent);
        }

        .chart-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn-del { 
            color: #555; 
            background: none; 
            border: none; 
            cursor: pointer; 
            font-size: 1.4rem; 
            line-height: 1; 
        }
        .btn-del:hover { color: var(--red); }

        #gen-trigger {
            position: fixed;
            bottom: 40px;
            right: 40px;
            background: var(--red);
            color: white;
            border-radius: 40px;
            padding: 20px 40px;
            box-shadow: 0 15px 30px rgba(229, 115, 115, 0.3);
            font-size: 1rem;
            z-index: 1000;
            border: none;
            font-weight: 700;
        }

        .output-box {
            margin-top: 30px;
            background: #141618;
            padding: 25px;
            border-radius: var(--radius);
            font-family: 'JetBrains Mono', monospace;
            white-space: pre-wrap;
            display: none;
            border-left: 4px solid var(--accent);
            animation: fadeIn 0.3s ease;
        }

        /* TABLE VIEW */
        #table-view {
            display: none;
            width: 100%;
            height: 100%;
            padding: 20px;
            gap: 20px;
            animation: fadeIn 0.4s ease;
            flex-direction: column;
            overflow: hidden;
            min-height: 0;
        }

        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--surface);
            padding: 20px;
            border-radius: var(--radius);
            margin-bottom: 10px;
            flex-shrink: 0;
            flex-wrap: wrap;
            gap: 15px;
        }

        .table-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: var(--surface);
            border-radius: var(--radius);
            padding: 20px;
            gap: 20px;
            overflow: hidden;
            min-height: 0;
        }

        .table-wrapper {
            flex: 1;
            background: rgba(255,255,255,0.02);
            border-radius: var(--radius);
            padding: 20px;
            overflow: auto;
            min-height: 300px;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            background: var(--bg);
            border-radius: var(--radius);
            overflow: hidden;
        }

        .data-table th {
            background: var(--panel);
            color: var(--text);
            padding: 15px;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid rgba(255,255,255,0.1);
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .data-table td {
            padding: 12px 15px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            color: var(--text);
        }

        .data-table tr:hover {
            background: rgba(255,255,255,0.03);
        }

        .data-table input {
            width: 100%;
            background: transparent;
            border: none;
            color: var(--text);
            padding: 8px;
            outline: none;
            font-family: 'Ubuntu', sans-serif;
        }

        .data-table input:focus {
            background: rgba(255,255,255,0.05);
            border-radius: 4px;
        }

        .table-controls {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        .table-btn {
            padding: 10px 20px;
            background: var(--bg);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 8px;
            color: var(--text);
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.9rem;
            white-space: nowrap;
        }

        .table-btn:hover {
            background: var(--accent);
            color: var(--bg);
            border-color: var(--accent);
        }

        .table-btn.red {
            background: var(--red);
            color: white;
            border-color: var(--red);
        }

        .table-btn.green {
            background: var(--green);
            color: white;
            border-color: var(--green);
        }

        .table-btn.blue {
            background: var(--blue);
            color: white;
            border-color: var(--blue);
        }

        .cell-actions {
            display: flex;
            gap: 5px;
        }

        .cell-btn {
            padding: 4px 8px;
            background: rgba(255,255,255,0.05);
            border: none;
            border-radius: 4px;
            color: var(--text-dim);
            cursor: pointer;
            font-size: 0.8rem;
            transition: var(--transition);
        }

        .cell-btn:hover {
            background: var(--accent);
            color: var(--bg);
        }

        .export-options {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        .table-title {
            flex: 1;
            min-width: 200px;
        }

        .table-title-input {
            width: 100%;
            background: var(--bg);
            border: 2px solid rgba(255,255,255,0.1);
            color: var(--text);
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 1.2rem;
            font-weight: bold;
            outline: none;
        }

        .table-title-input:focus {
            border-color: var(--accent);
        }

        /* EMPTY HINT */
        #empty-hint {
            text-align: center;
            margin-top: 20%;
            opacity: 0.1;
            transition: 0.5s;
        }

        #empty-hint h1 {
            font-size: 3rem;
            font-weight: 700;
            background: linear-gradient(90deg, var(--red), #ff9a9a);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        #empty-hint .logo-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            display: block;
        }

        #empty-hint .subtitle {
            color: var(--text-dim);
            font-size: 1.2rem;
            font-weight: 300;
            letter-spacing: 2px;
        }
    </style>
</head>
<body>

<nav>
    <div class="nav-logo">
        <span class="logo-icon">üî¥</span>
        <span class="logo-text">GMIKIRED</span>
    </div>
    <div class="nav-item active" id="nav-prot" onclick="switchMode('protocol')">1. –ü—Ä–æ—Ç–æ–∫–æ–ª</div>
    <div class="nav-item" id="nav-edit" onclick="switchMode('editor')">2. –†–µ–¥–∞–∫—Ç–æ—Ä</div>
    <div class="nav-item" id="nav-graph" onclick="switchMode('graph')">3. –ì—Ä–∞—Ñ–∏–∫</div>
    <div class="nav-item" id="nav-table" onclick="switchMode('table')">4. –¢–∞–±–ª–∏—Ü–∞</div>
</nav>

<div id="main-wrapper">
    <div id="protocol-view" style="display: flex; width: 100%;">
        <div id="sidebar">
            <button class="btn-action" onclick="createUser()" style="width: 100%; border-style: dashed; border-width: 2px; border-color: var(--red);">+ –î–æ–±–∞–≤–∏—Ç—å —Å—É–±—ä–µ–∫—Ç</button>
            <div id="user-list" style="margin-top: 20px;"></div>
        </div>
        <div id="protocol-content">
            <div id="editor-card" class="card" style="display:none">
                <label>–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (–ò–º—è)</label>
                <input type="text" id="inp-name" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è..." oninput="sync()">
                
                <div style="height: 25px;"></div>
                
                <label>–†–µ–µ—Å—Ç—Ä —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –∑–∞–¥–∞—á</label>
                <div id="list-std"></div>
                <button class="btn-action" onclick="addTask('std')" style="padding: 8px 20px; font-size: 0.8rem;">+ –î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É</button>

                <div style="height: 35px;"></div>
                
                <label style="color: var(--red);">–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –¥–∏—Ä–µ–∫—Ç–∏–≤—ã</label>
                <div id="list-urg"></div>
                <button class="btn-action" onclick="addTask('urg')" style="padding: 8px 20px; font-size: 0.8rem; border-color: rgba(229,115,115,0.3);">+ –î–æ–±–∞–≤–∏—Ç—å —Å—Ä–æ—á–Ω–æ</button>
                
                <div id="final-output" class="output-box"></div>
            </div>
            <div id="empty-hint" style="text-align:center; margin-top:20%; opacity:0.1; transition: 0.5s;">
                <span class="logo-icon">üî¥</span>
                <h1>GMIKIRED</h1>
                <div class="subtitle">SYSTEM CORE</div>
            </div>
        </div>
        <button id="gen-trigger" class="btn-action" onclick="generateAll()">–°–ö–û–ü–ò–†–û–í–ê–¢–¨ –ü–†–û–ú–¢</button>
    </div>

    <div id="editor-view">
        <div class="editor-container">
            <div style="display: flex; gap: 12px;">
                <button class="btn-action" onclick="runCode()" style="background: var(--red); color: white; border-color: var(--red);">‚ñ∂ –ó–∞–ø—É—Å—Ç–∏—Ç—å (F11)</button>
                <button class="btn-action" onclick="clearEditor()" style="color: var(--red);">–û—á–∏—Å—Ç–∏—Ç—å</button>
            </div>
            <textarea id="html-code" placeholder="<html>
<style> body { background: #eee; } </style>
<body> <h1>Hello World</h1> </body>
</html>"></textarea>
        </div>
        <iframe id="preview"></iframe>
    </div>

    <!-- FULLSCREEN OVERLAY -->
    <div id="fullscreen-overlay">
        <div class="fullscreen-header">
            <div class="fullscreen-title">
                <span class="logo-icon">üî¥</span>
                <span>GmikiRed Editor - –ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º</span>
            </div>
            <div class="fullscreen-controls">
                <span class="fullscreen-hint">–ù–∞–∂–º–∏—Ç–µ ESC –¥–ª—è –≤—ã—Ö–æ–¥–∞</span>
                <button class="btn-action" onclick="exitFullscreen()" style="background: var(--red); color: white; border-color: var(--red);">–í—ã–π—Ç–∏ (ESC)</button>
            </div>
        </div>
        <div class="fullscreen-content">
            <iframe id="fullscreen-preview" class="fullscreen-preview"></iframe>
        </div>
        <button class="close-fullscreen-btn" onclick="exitFullscreen()">√ó</button>
    </div>

    <div id="graph-view">
        <div class="graph-header">
            <div class="graph-type-selector">
                <button class="graph-type-btn active" onclick="setChartType('line')">–õ–∏–Ω–∏—è</button>
                <button class="graph-type-btn" onclick="setChartType('bar')">–°—Ç–æ–ª–±—Ü—ã</button>
                <button class="graph-type-btn" onclick="setChartType('radar')">–†–∞–¥–∞—Ä</button>
                <button class="graph-type-btn" onclick="setChartType('pie')">–ö—Ä—É–≥</button>
            </div>
            
            <div class="chart-actions">
                <button class="btn-action" onclick="addDataset()">+ –ù–∞–±–æ—Ä</button>
                <button class="btn-action" onclick="downloadChart()" style="background: var(--green); color: white;">‚Üì PNG</button>
                <button class="btn-action" onclick="resetChart()" style="background: var(--red); color: white;">–°–±—Ä–æ—Å</button>
            </div>
        </div>

        <div class="graph-container">
            <div class="dataset-selector" id="dataset-tabs">
                <!-- –í–∫–ª–∞–¥–∫–∏ –Ω–∞–±–æ—Ä–æ–≤ –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
            </div>

            <div class="chart-area-wrapper">
                <canvas id="myChart"></canvas>
            </div>

            <div id="dataset-editor-container">
                <!-- –†–µ–¥–∞–∫—Ç–æ—Ä —Ç–µ–∫—É—â–µ–≥–æ –Ω–∞–±–æ—Ä–∞ –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
            </div>
        </div>
    </div>

    <div id="table-view">
        <div class="table-header">
            <div class="table-title">
                <input type="text" id="table-title" value="–ú–æ—è —Ç–∞–±–ª–∏—Ü–∞" class="table-title-input" oninput="updateTableTitle()">
            </div>
            
            <div class="export-options">
                <button class="table-btn green" onclick="addRow()">+ –°—Ç—Ä–æ–∫–∞</button>
                <button class="table-btn blue" onclick="addColumn()">+ –°—Ç–æ–ª–±–µ—Ü</button>
                <button class="table-btn" onclick="exportTablePNG()">üì∑ PNG</button>
                <button class="table-btn" onclick="exportTablePDF()">üìÑ PDF</button>
                <button class="table-btn red" onclick="clearTable()">–û—á–∏—Å—Ç–∏—Ç—å</button>
            </div>
        </div>

        <div class="table-container">
            <div class="table-wrapper">
                <table class="data-table" id="data-table">
                    <thead>
                        <tr id="table-header">
                            <th style="min-width: 50px;">#</th>
                            <th contenteditable="true" onblur="updateColumnName(0, this.textContent)">–ö–æ–ª–æ–Ω–∫–∞ 1</th>
                            <th contenteditable="true" onblur="updateColumnName(1, this.textContent)">–ö–æ–ª–æ–Ω–∫–∞ 2</th>
                            <th contenteditable="true" onblur="updateColumnName(2, this.textContent)">–ö–æ–ª–æ–Ω–∫–∞ 3</th>
                        </tr>
                    </thead>
                    <tbody id="table-body">
                        <tr>
                            <td style="font-weight: bold; background: rgba(255,255,255,0.02);">1</td>
                            <td><input type="text" value="–î–∞–Ω–Ω—ã–µ 1" oninput="updateCell(0,0,this.value)"></td>
                            <td><input type="text" value="–î–∞–Ω–Ω—ã–µ 2" oninput="updateCell(0,1,this.value)"></td>
                            <td><input type="text" value="–î–∞–Ω–Ω—ã–µ 3" oninput="updateCell(0,2,this.value)"></td>
                        </tr>
                        <tr>
                            <td style="font-weight: bold; background: rgba(255,255,255,0.02);">2</td>
                            <td><input type="text" value="–î–∞–Ω–Ω—ã–µ 4" oninput="updateCell(1,0,this.value)"></td>
                            <td><input type="text" value="–î–∞–Ω–Ω—ã–µ 5" oninput="updateCell(1,1,this.value)"></td>
                            <td><input type="text" value="–î–∞–Ω–Ω—ã–µ 6" oninput="updateCell(1,2,this.value)"></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="table-controls">
                <div style="display: flex; gap: 5px; flex-wrap: wrap;">
                    <button class="cell-btn" onclick="sortTable(0, 'asc')">‚Üë –ü–æ –∫–æ–ª–æ–Ω–∫–µ 1</button>
                    <button class="cell-btn" onclick="sortTable(1, 'asc')">‚Üë –ü–æ –∫–æ–ª–æ–Ω–∫–µ 2</button>
                    <button class="cell-btn" onclick="sortTable(2, 'asc')">‚Üë –ü–æ –∫–æ–ª–æ–Ω–∫–µ 3</button>
                </div>
                <div style="margin-left: auto; color: var(--text-dim); font-size: 0.9rem;">
                    –í—Å–µ–≥–æ —Å—Ç—Ä–æ–∫: <span id="row-count">2</span>, —Å—Ç–æ–ª–±—Ü–æ–≤: <span id="col-count">3</span>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è jsPDF
    const { jsPDF } = window.jspdf;
    
    let users = JSON.parse(localStorage.getItem('soft_db_v4')) || [];
    let cur = null;
    let chart = null;
    let currentChartType = 'line';
    let currentDatasetIndex = 0;
    
    // –î–∞–Ω–Ω—ã–µ –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞
    let chartData = JSON.parse(localStorage.getItem('chart_data_v2')) || {
        labels: ['00:00', '04:00', '08:00', '12:00', '16:00', '20:00', '00:00'],
        datasets: [
            {
                id: 1,
                name: '–î–∞–Ω–Ω—ã–µ 1',
                color: '#e57373', // –ö—Ä–∞—Å–Ω—ã–π —Ü–≤–µ—Ç –¥–ª—è GmikiRed
                values: [10.5, 22.3, 35.7, 42.1, 38.4, 25.9, 12.7],
                visible: true
            }
        ]
    };

    // –î–∞–Ω–Ω—ã–µ –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã
    let tableData = JSON.parse(localStorage.getItem('table_data')) || {
        title: "–ú–æ—è —Ç–∞–±–ª–∏—Ü–∞",
        columns: ["–ö–æ–ª–æ–Ω–∫–∞ 1", "–ö–æ–ª–æ–Ω–∫–∞ 2", "–ö–æ–ª–æ–Ω–∫–∞ 3"],
        rows: [
            ["–î–∞–Ω–Ω—ã–µ 1", "–î–∞–Ω–Ω—ã–µ 2", "–î–∞–Ω–Ω—ã–µ 3"],
            ["–î–∞–Ω–Ω—ã–µ 4", "–î–∞–Ω–Ω—ã–µ 5", "–î–∞–Ω–Ω—ã–µ 6"]
        ]
    };

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∞–≤–∏—à–∏ ESC –¥–ª—è –≤—ã—Ö–æ–¥–∞ –∏–∑ –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞
    document.addEventListener('keydown', function(event) {
        if (event.key === 'Escape' || event.key === 'Esc') {
            exitFullscreen();
        }
        if (event.key === 'F11') {
            event.preventDefault();
            runCode();
        }
    });

    function switchMode(mode) {
        document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
        
        // –°–∫—Ä—ã—Ç—å –≤—Å–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è
        document.getElementById('protocol-view').style.display = 'none';
        document.getElementById('editor-view').style.display = 'none';
        document.getElementById('graph-view').style.display = 'none';
        document.getElementById('table-view').style.display = 'none';
        document.getElementById('gen-trigger').style.display = 'none';
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –Ω—É–∂–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ
        if(mode === 'protocol') {
            document.getElementById('nav-prot').classList.add('active');
            document.getElementById('protocol-view').style.display = 'flex';
            document.getElementById('gen-trigger').style.display = 'block';
        } else if(mode === 'editor') {
            document.getElementById('nav-edit').classList.add('active');
            document.getElementById('editor-view').style.display = 'flex';
        } else if(mode === 'graph') {
            document.getElementById('nav-graph').classList.add('active');
            document.getElementById('graph-view').style.display = 'flex';
            setTimeout(initChart, 50);
        } else if(mode === 'table') {
            document.getElementById('nav-table').classList.add('active');
            document.getElementById('table-view').style.display = 'flex';
            renderTable();
        }
    }

    function save() { localStorage.setItem('soft_db_v4', JSON.stringify(users)); renderSidebar(); }
    
    // –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –ü–£–°–¢–´–ú –∏–º–µ–Ω–µ–º
    function createUser() { 
        users.push({ name: "", std: ["", "", ""], urg: [] }); 
        save(); 
        select(users.length - 1); 
    }
    
    function renderSidebar() {
        document.getElementById('user-list').innerHTML = users.map((u, i) => `
            <div class="user-tab ${i === cur ? 'active' : ''}" onclick="select(${i})">
                <span style="font-weight: 600;">${u.name || '–ë–µ–∑ –∏–º–µ–Ω–∏'}</span>
                <button class="btn-del" onclick="delUser(event, ${i})">√ó</button>
            </div>`).join('');
    }

    function select(i) {
        cur = i;
        document.getElementById('empty-hint').style.display = 'none';
        document.getElementById('editor-card').style.display = 'block';
        document.getElementById('inp-name').value = users[i].name;
        renderTasks(); renderSidebar();
    }

    function renderTasks() {
        const u = users[cur];
        document.getElementById('list-std').innerHTML = u.std.map((t, i) => `
            <div style="display:flex; gap:10px; margin-bottom:12px;">
                <input type="text" value="${t}" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è..." oninput="updTask('std', ${i}, this.value)">
                <button class="btn-del" onclick="remTask('std', ${i})">√ó</button>
            </div>`).join('');
        document.getElementById('list-urg').innerHTML = u.urg.map((t, i) => `
            <div style="display:flex; gap:10px; margin-bottom:12px;">
                <input type="text" value="${t}" placeholder="–°—Ä–æ—á–Ω–æ–µ —Ä–∞—Å–ø–æ—Ä—è–∂–µ–Ω–∏–µ..." oninput="updTask('urg', ${i}, this.value)" style="border-color: rgba(229,115,115,0.3)">
                <button class="btn-del" onclick="remTask('urg', ${i})">√ó</button>
            </div>`).join('');
    }

    function updTask(type, i, v) { users[cur][type][i] = v; localStorage.setItem('soft_db_v4', JSON.stringify(users)); }
    function sync() { users[cur].name = document.getElementById('inp-name').value; save(); }
    function addTask(type) { users[cur][type].push(""); renderTasks(); }
    function remTask(type, i) { users[cur][type].splice(i, 1); renderTasks(); save(); }
    function delUser(e, i) { e.stopPropagation(); users.splice(i, 1); cur = null; save(); location.reload(); }

    function generateAll() {
        let p = "";
        users.forEach(u => {
            if(!u.name.trim()) return;
            const std = u.std.filter(t => t.trim());
            const urg = u.urg.filter(t => t.trim());
            p += `–î–æ–±–∞–≤—å –Ω–æ–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é "${u.name}". –ó–∞–¥–∞–Ω–∏—è –µ–º—É –¥–∞–π —Å–ª–µ–¥—É—é—â–∏–µ:\n`;
            std.forEach((t, idx) => p += `${idx+1}. ${t}\n`);
            if(urg.length > 0) {
                p += `\n–°—Ä–æ—á–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è:\n`;
                urg.forEach((t, idx) => p += `${idx+1}. ${t}\n`);
            }
            p += `\n---\n\n`;
        });
        const out = document.getElementById('final-output');
        out.innerText = p; out.style.display = 'block';
        navigator.clipboard.writeText(p);
        alert("–ì–û–¢–û–í–û: –û–±—â–∏–π –ø—Ä–æ–º—Ç –≤ –±—É—Ñ–µ—Ä–µ –æ–±–º–µ–Ω–∞");
    }

    function runCode() {
        const code = document.getElementById('html-code').value;
        const preview = document.getElementById('preview').contentWindow.document;
        preview.open(); preview.write(code); preview.close();
        
        // –û—Ç–∫—Ä—ã–≤–∞–µ–º –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º
        openFullscreen(code);
    }

    function openFullscreen(code) {
        const overlay = document.getElementById('fullscreen-overlay');
        const fullscreenPreview = document.getElementById('fullscreen-preview').contentWindow.document;
        
        // –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –∫–æ–¥ –≤ –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π –ø—Ä–µ–≤—å—é
        fullscreenPreview.open();
        fullscreenPreview.write(code);
        fullscreenPreview.close();
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–≤–µ—Ä–ª–µ–π
        overlay.style.display = 'flex';
        
        // –ë–ª–æ–∫–∏—Ä—É–µ–º —Å–∫—Ä–æ–ª–ª –Ω–∞ –æ—Å–Ω–æ–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
        document.body.style.overflow = 'hidden';
    }

    function exitFullscreen() {
        const overlay = document.getElementById('fullscreen-overlay');
        overlay.style.display = 'none';
        
        // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–∫—Ä–æ–ª–ª
        document.body.style.overflow = '';
    }

    function clearEditor() {
        document.getElementById('html-code').value = "";
        document.getElementById('preview').src = "about:blank";
    }

    // ==================== –ì–†–ê–§–ò–ö–ò ====================
    function initChart() {
        const ctx = document.getElementById('myChart').getContext('2d');
        
        if (chart) {
            chart.destroy();
        }
        
        renderDatasetTabs();
        
        const visibleDatasets = chartData.datasets.filter(ds => ds.visible);
        
        chart = new Chart(ctx, {
            type: currentChartType,
            data: {
                labels: chartData.labels,
                datasets: visibleDatasets.map(dataset => {
                    const rgb = hexToRgb(dataset.color);
                    return {
                        label: dataset.name,
                        data: dataset.values,
                        backgroundColor: `rgba(${rgb.r}, ${rgb.g}, ${rgb.b}, ${currentChartType === 'line' ? '0.1' : '0.6'})`,
                        borderColor: `rgba(${rgb.r}, ${rgb.g}, ${rgb.b}, 1)`,
                        borderWidth: currentChartType === 'line' ? 2 : 1,
                        fill: currentChartType === 'line',
                        pointRadius: 4,
                        pointHoverRadius: 6,
                        tension: 0.3
                    };
                })
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                interaction: {
                    mode: 'index',
                    intersect: false,
                },
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        backgroundColor: 'rgba(30, 33, 36, 0.95)',
                        titleColor: '#e1e1e1',
                        bodyColor: '#e1e1e1',
                        borderColor: 'rgba(142, 153, 162, 0.5)',
                        borderWidth: 1,
                        padding: 12,
                        callbacks: {
                            label: function(context) {
                                return `${context.dataset.label}: ${context.parsed.y.toFixed(2)}`;
                            }
                        }
                    }
                },
                scales: currentChartType !== 'pie' && currentChartType !== 'radar' ? {
                    x: {
                        grid: {
                            color: 'rgba(255,255,255,0.05)',
                            drawTicks: false
                        },
                        ticks: {
                            color: '#9ba1a6',
                            font: {
                                size: 11
                            }
                        }
                    },
                    y: {
                        beginAtZero: true,
                        grid: {
                            color: 'rgba(255,255,255,0.05)',
                            drawTicks: false
                        },
                        ticks: {
                            color: '#9ba1a6',
                            font: {
                                size: 11
                            },
                            precision: 2,
                            stepSize: getStepSize()
                        }
                    }
                } : {},
                animation: {
                    duration: 300
                }
            }
        });
        
        renderDatasetEditor();
        saveChartData();
    }

    function getStepSize() {
        const allValues = chartData.datasets.flatMap(ds => ds.values);
        const max = Math.max(...allValues);
        const min = Math.min(...allValues);
        const range = max - min;
        
        if (range < 1) return 0.1;
        if (range < 5) return 0.5;
        if (range < 20) return 1;
        if (range < 50) return 5;
        if (range < 100) return 10;
        return Math.ceil(range / 20);
    }

    function hexToRgb(hex) {
        const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
        return result ? {
            r: parseInt(result[1], 16),
            g: parseInt(result[2], 16),
            b: parseInt(result[3], 16)
        } : { r: 229, g: 115, b: 115 };
    }

    function setChartType(type) {
        currentChartType = type;
        document.querySelectorAll('.graph-type-btn').forEach(btn => btn.classList.remove('active'));
        event.target.classList.add('active');
        initChart();
    }

    function renderDatasetTabs() {
        const tabsContainer = document.getElementById('dataset-tabs');
        tabsContainer.innerHTML = chartData.datasets.map((dataset, index) => `
            <div class="dataset-tab ${index === currentDatasetIndex ? 'active' : ''}" 
                 onclick="selectDataset(${index})">
                <span class="dataset-color" style="background: ${dataset.color}"></span>
                ${dataset.name}
                ${!dataset.visible ? '<span style="opacity: 0.5;"> (—Å–∫—Ä—ã—Ç)</span>' : ''}
            </div>
        `).join('');
    }

    function selectDataset(index) {
        currentDatasetIndex = index;
        renderDatasetTabs();
        renderDatasetEditor();
    }

    function renderDatasetEditor() {
        const dataset = chartData.datasets[currentDatasetIndex];
        const container = document.getElementById('dataset-editor-container');
        
        container.innerHTML = `
            <div class="dataset-editor">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <div style="display: flex; align-items: center; gap: 15px; flex-wrap: wrap;">
                        <input type="text" 
                               value="${dataset.name}" 
                               oninput="updateDatasetName(${currentDatasetIndex}, this.value)"
                               style="background: var(--surface); border: 1px solid rgba(255,255,255,0.1); color: var(--text); padding: 8px 12px; border-radius: 6px; width: 200px;">
                        
                        <input type="color" 
                               value="${dataset.color}" 
                               onchange="updateDatasetColor(${currentDatasetIndex}, this.value)"
                               style="width: 40px; height: 40px; border: none; border-radius: 8px; cursor: pointer;">
                        
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                            <input type="checkbox" 
                                   ${dataset.visible ? 'checked' : ''}
                                   onchange="toggleDatasetVisibility(${currentDatasetIndex})">
                            –ü–æ–∫–∞–∑–∞—Ç—å –Ω–∞ –≥—Ä–∞—Ñ–∏–∫–µ
                        </label>
                    </div>
                    
                    <button class="btn-del" onclick="removeDataset(${currentDatasetIndex})" style="font-size: 1.2rem;">√ó –£–¥–∞–ª–∏—Ç—å</button>
                </div>
                
                <div class="point-controls">
                    ${dataset.values.map((value, i) => `
                        <div class="point-item">
                            <small>${chartData.labels[i] || `–¢–æ—á–∫–∞ ${i+1}`}</small>
                            <input type="number" 
                                   step="0.1"
                                   value="${value.toFixed(2)}" 
                                   oninput="updatePointValue(${currentDatasetIndex}, ${i}, this.value)"
                                   class="point-value">
                        </div>
                    `).join('')}
                </div>
                
                <div style="display: flex; gap: 10px; margin-top: 15px;">
                    <button class="btn-action" onclick="addPoint(${currentDatasetIndex})" style="padding: 8px 16px; font-size: 0.8rem;">+ –¢–æ—á–∫–∞</button>
                    <button class="btn-action" onclick="randomizeDataset(${currentDatasetIndex})" style="padding: 8px 16px; font-size: 0.8rem;">üé≤ –°–ª—É—á–∞–π–Ω–æ</button>
                </div>
            </div>
        `;
    }

    function updateDatasetName(index, name) {
        chartData.datasets[index].name = name;
        renderDatasetTabs();
        initChart();
    }

    function updateDatasetColor(index, color) {
        chartData.datasets[index].color = color;
        initChart();
    }

    function toggleDatasetVisibility(index) {
        chartData.datasets[index].visible = !chartData.datasets[index].visible;
        renderDatasetTabs();
        initChart();
    }

    function updatePointValue(datasetIndex, pointIndex, value) {
        const numValue = parseFloat(value);
        if (!isNaN(numValue)) {
            chartData.datasets[datasetIndex].values[pointIndex] = numValue;
            initChart();
        }
    }

    function addPoint(datasetIndex) {
        chartData.datasets.forEach(ds => {
            ds.values.push(ds.values.length > 0 ? ds.values[ds.values.length - 1] : 0);
        });
        chartData.labels.push(`–¢–æ—á–∫–∞ ${chartData.labels.length + 1}`);
        renderDatasetEditor();
        initChart();
    }

    function randomizeDataset(datasetIndex) {
        chartData.datasets[datasetIndex].values = chartData.datasets[datasetIndex].values.map(() => 
            Math.random() * 50
        );
        renderDatasetEditor();
        initChart();
    }

    function addDataset() {
        const colors = ['#e57373', '#81c784', '#64b5f6', '#ba68c8', '#ffb74d', '#4db6ac'];
        const colorIndex = chartData.datasets.length % colors.length;
        
        const newDataset = {
            id: Date.now(),
            name: `–î–∞–Ω–Ω—ã–µ ${chartData.datasets.length + 1}`,
            color: colors[colorIndex],
            values: chartData.labels.map(() => Math.random() * 50),
            visible: true
        };
        
        chartData.datasets.push(newDataset);
        currentDatasetIndex = chartData.datasets.length - 1;
        initChart();
    }

    function removeDataset(index) {
        if (chartData.datasets.length <= 1) {
            alert('–î–æ–ª–∂–µ–Ω –æ—Å—Ç–∞—Ç—å—Å—è —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –Ω–∞–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö');
            return;
        }
        
        chartData.datasets.splice(index, 1);
        currentDatasetIndex = Math.max(0, currentDatasetIndex - 1);
        initChart();
    }

    function downloadChart() {
        const chartCanvas = document.getElementById('myChart');
        
        html2canvas(chartCanvas, {
            backgroundColor: '#24272b',
            scale: 2,
            logging: false,
            useCORS: true
        }).then(canvas => {
            const link = document.createElement('a');
            link.download = `–≥—Ä–∞—Ñ–∏–∫-gmikired-${new Date().toISOString().slice(0,10)}.png`;
            link.href = canvas.toDataURL('image/png');
            link.click();
        });
    }

    function resetChart() {
        if (confirm('–°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –≥—Ä–∞—Ñ–∏–∫–∞?')) {
            chartData = {
                labels: ['00:00', '04:00', '08:00', '12:00', '16:00', '20:00', '00:00'],
                datasets: [
                    {
                        id: 1,
                        name: '–î–∞–Ω–Ω—ã–µ 1',
                        color: '#e57373',
                        values: [10.5, 22.3, 35.7, 42.1, 38.4, 25.9, 12.7],
                        visible: true
                    }
                ]
            };
            
            currentDatasetIndex = 0;
            currentChartType = 'line';
            
            document.querySelectorAll('.graph-type-btn').forEach((btn, i) => {
                btn.classList.toggle('active', i === 0);
            });
            
            saveChartData();
            initChart();
        }
    }

    function saveChartData() {
        localStorage.setItem('chart_data_v2', JSON.stringify(chartData));
    }

    // ==================== –¢–ê–ë–õ–ò–¶–ê ====================
    function renderTable() {
        document.getElementById('table-title').value = tableData.title;
        
        const headerRow = document.getElementById('table-header');
        const tbody = document.getElementById('table-body');
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏
        headerRow.innerHTML = '<th style="min-width: 50px;">#</th>';
        tableData.columns.forEach((col, index) => {
            headerRow.innerHTML += `
                <th contenteditable="true" 
                    onblur="updateColumnName(${index}, this.textContent)"
                    style="position: relative;">
                    ${col}
                    <button class="cell-btn" onclick="removeColumn(${index})" 
                            style="position: absolute; right: 5px; top: 50%; transform: translateY(-50%); padding: 2px 6px; font-size: 0.7rem;">
                        √ó
                    </button>
                </th>
            `;
        });
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç—Ä–æ–∫–∏
        tbody.innerHTML = '';
        tableData.rows.forEach((row, rowIndex) => {
            let rowHtml = `<tr>
                <td style="font-weight: bold; background: rgba(255,255,255,0.02);">
                    ${rowIndex + 1}
                    <button class="cell-btn" onclick="removeRow(${rowIndex})" style="margin-left: 5px;">√ó</button>
                </td>`;
            
            row.forEach((cell, colIndex) => {
                rowHtml += `
                    <td>
                        <input type="text" 
                               value="${cell}" 
                               oninput="updateCell(${rowIndex}, ${colIndex}, this.value)"
                               style="width: 100%;">
                    </td>
                `;
            });
            
            rowHtml += '</tr>';
            tbody.innerHTML += rowHtml;
        });
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫–∏
        document.getElementById('row-count').textContent = tableData.rows.length;
        document.getElementById('col-count').textContent = tableData.columns.length;
        
        saveTableData();
    }

    function updateTableTitle() {
        tableData.title = document.getElementById('table-title').value;
        saveTableData();
    }

    function updateColumnName(index, name) {
        if (index >= 0 && index < tableData.columns.length) {
            tableData.columns[index] = name;
            saveTableData();
        }
    }

    function updateCell(rowIndex, colIndex, value) {
        if (rowIndex >= 0 && rowIndex < tableData.rows.length && 
            colIndex >= 0 && colIndex < tableData.columns.length) {
            tableData.rows[rowIndex][colIndex] = value;
            saveTableData();
        }
    }

    function addRow() {
        const newRow = new Array(tableData.columns.length).fill('');
        tableData.rows.push(newRow);
        renderTable();
    }

    function addColumn() {
        tableData.columns.push(`–ö–æ–ª–æ–Ω–∫–∞ ${tableData.columns.length + 1}`);
        tableData.rows.forEach(row => row.push(''));
        renderTable();
    }

    function removeRow(index) {
        if (tableData.rows.length > 1) {
            tableData.rows.splice(index, 1);
            renderTable();
        } else {
            alert('–¢–∞–±–ª–∏—Ü–∞ –¥–æ–ª–∂–Ω–∞ —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É');
        }
    }

    function removeColumn(index) {
        if (tableData.columns.length > 1) {
            tableData.columns.splice(index, 1);
            tableData.rows.forEach(row => row.splice(index, 1));
            renderTable();
        } else {
            alert('–¢–∞–±–ª–∏—Ü–∞ –¥–æ–ª–∂–Ω–∞ —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —Å—Ç–æ–ª–±–µ—Ü');
        }
    }

    function sortTable(columnIndex, order) {
        tableData.rows.sort((a, b) => {
            const valA = a[columnIndex] || '';
            const valB = b[columnIndex] || '';
            
            if (order === 'asc') {
                return valA.toString().localeCompare(valB.toString());
            } else {
                return valB.toString().localeCompare(valA.toString());
            }
        });
        
        renderTable();
    }

    function clearTable() {
        if (confirm('–û—á–∏—Å—Ç–∏—Ç—å –≤—Å—é —Ç–∞–±–ª–∏—Ü—É?')) {
            tableData = {
                title: "–ù–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞",
                columns: ["–ö–æ–ª–æ–Ω–∫–∞ 1", "–ö–æ–ª–æ–Ω–∫–∞ 2"],
                rows: [
                    ["", ""],
                    ["", ""]
                ]
            };
            renderTable();
        }
    }

    function exportTablePNG() {
        const tableElement = document.getElementById('data-table');
        
        html2canvas(tableElement, {
            backgroundColor: '#24272b',
            scale: 2,
            logging: false,
            useCORS: true
        }).then(canvas => {
            const link = document.createElement('a');
            link.download = `${tableData.title}-gmikired-${new Date().toISOString().slice(0,10)}.png`;
            link.href = canvas.toDataURL('image/png');
            link.click();
        });
    }

    function exportTablePDF() {
        const doc = new jsPDF({
            orientation: tableData.columns.length > 5 ? 'landscape' : 'portrait',
            unit: 'mm',
            format: 'a4'
        });
        
        // –ó–∞–≥–æ–ª–æ–≤–æ–∫
        doc.setFontSize(16);
        doc.setTextColor(229, 115, 115);
        doc.text("GmikiRed - " + tableData.title, 14, 15);
        doc.setTextColor(0, 0, 0);
        
        // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã
        const tableBody = [];
        tableData.rows.forEach(row => {
            tableBody.push(row);
        });
        
        // –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã
        doc.autoTable({
            head: [tableData.columns],
            body: tableBody,
            startY: 25,
            theme: 'striped',
            headStyles: {
                fillColor: [36, 39, 43],
                textColor: [225, 225, 225],
                fontStyle: 'bold'
            },
            bodyStyles: {
                fillColor: [26, 28, 30],
                textColor: [225, 225, 225]
            },
            alternateRowStyles: {
                fillColor: [30, 33, 36]
            },
            margin: { top: 25 }
        });
        
        doc.save(`gmikired-${tableData.title}.pdf`);
    }

    function saveTableData() {
        localStorage.setItem('table_data', JSON.stringify(tableData));
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    renderSidebar();
</script>
</body>
</html>
